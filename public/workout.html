<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Plan Organizer - CareConnect</title>
  <link rel="stylesheet" href="./css/styles.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=account_circle,fitness_center,add,refresh" />
</head>
<body>
  <header>
    <div class="container header-container">
      <img src="./assets/CareConnectblue.png" alt="CareConnect Logo" class="logo">
      <nav>
        <ul class="nav-list">
          <li><a href="./index.html">Home</a></li>
          <li class="dropdown">
            <a href="#features">Features</a>
            <ul class="dropdown-menu">
              <li><a href="./medications.html">Medication Manager</a></li>
              <li><a href="./bus.html">Live Bus Tracker</a></li>
              <li><a href="./login.html">User Login &amp; Signup</a></li>
              <li><a href="./shoplist.html">Shopping List Manager</a></li>
              <li><a href="./emergency.html">Emergency Quick-Dial</a></li>
              <li><a href="./checklist.html">Checklist Creator</a></li>
              <li><a href="./event-planner.html">Event Planner</a></li>
              <li><a href="./calendar.html">Activity Calendar</a></li>
              <li><a href="./overview.html">Overview Dashboard</a></li>
              <li><a href="./health-records.html">Health Records</a></li>
              <li><a href="./reminder.html">Reminders</a></li>
              <li><a href="./translation.html">Auto-Translation</a></li>
              <li><a href="./doctor-login.html">Doctor &amp; Caretaker Login</a></li>
              <li><a href="./profile.html">User Profile Manager</a></li>
              <li><a href="./workout.html">Workout Plan Organizer</a></li>
              <li><a href="./daily-log.html">Daily Log Tracker</a></li>
            </ul>
          </li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
          <li><a href="./signup.html"><span class="material-symbols-outlined">account_circle</span></a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <section class="hero-section">
      <div class="container">
        <h1><span class="material-symbols-outlined">fitness_center</span> Workout Plan Organizer</h1>
        <p>Create and track simple exercise routines designed for your fitness level and goals.</p>
      </div>
    </section>

    <section class="features-section">
      <div class="container">
        <!-- AI Workout Generator -->
        <div class="workout-generator">
          <h2>AI Workout Suggestions</h2>
          <p>Get personalized workout recommendations based on your needs.</p>
          <button id="generateWorkout" class="btn">
            <span class="material-symbols-outlined">refresh</span>
            Generate New Workout Plan
          </button>
          <div id="aiWorkoutResult" class="workout-result"></div>
        </div>

        <!-- Default Workout Plans -->
        <div class="default-workouts">
          <h2>Recommended Workout Plans</h2>
          <div id="defaultWorkoutList" class="features-grid">
            <!-- Default workout plans will be loaded here -->
          </div>
        </div>

        <!-- Personal Workout Plans -->
        <div class="workout-plans">
          <h2>Your Personal Workout Plans</h2>
          <div id="personalWorkoutList" class="features-grid">
            <!-- Personal workout plans will be loaded here -->
          </div>
        </div>

        <!-- Add New Workout Form -->
        <div class="add-workout">
          <h2>Add New Workout</h2>
          <form id="workoutForm" class="workout-form">
            <div class="form-group">
              <label for="exerciseName">Exercise Name:</label>
              <input type="text" id="exerciseName" name="exerciseName" placeholder="e.g. Push-ups, Walking, Stretching" required>
            </div>
            
            <div class="form-group">
              <label for="reps">Reps (optional):</label>
              <input type="number" id="reps" name="reps" min="1" max="50" placeholder="Leave empty if time-based">
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="sets">Sets (optional):</label>
                <input type="number" id="sets" name="sets" min="1" max="10" placeholder="Leave empty if time-based">
              </div>
              
              <div class="form-group">
                <label for="duration">Duration (minutes):</label>
                <input type="number" id="duration" name="duration" min="5" max="120" required>
              </div>
            </div>
            
            <div class="form-group">
              <label for="activityLevel">Activity Level:</label>
              <select id="activityLevel" name="activityLevel" required>
                <option value="">Select Activity Level</option>
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="imageUrl">Exercise Image URL (optional):</label>
              <input type="url" id="imageUrl" name="imageUrl" placeholder="https://example.com/image.jpg">
            </div>
            
            <div class="form-group">
              <label for="instructions">Instructions:</label>
              <textarea id="instructions" name="instructions" rows="4" placeholder="Describe how to perform this exercise..."></textarea>
            </div>
            
            <button type="submit" class="btn">
              <span class="material-symbols-outlined">add</span>
              Add Workout Plan
            </button>
          </form>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div class="container footer-container">
      <p>&copy; 2025 CareConnect. All rights reserved.</p>
      <ul class="footer-nav">
        <li><a href="#privacy">Privacy Policy</a></li>
        <li><a href="#terms">Terms of Service</a></li>
        <li><a href="#support">Support</a></li>
      </ul>
    </div>
  </footer>

  <!-- Add this modal before closing body tag -->
    <div id="workoutModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modalContent">
          <!-- Exercise details will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Add this CSS -->
    <style>
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
      }

      .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: none;
        border-radius: 10px;
        width: 80%;
        max-width: 600px;
        position: relative;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        position: absolute;
        right: 15px;
        top: 10px;
      }

      .close:hover,
      .close:focus {
        color: #000;
      }

      .exercise-image {
        width: 100%;
        max-width: 400px;
        height: 300px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      .exercise-details {
        text-align: center;
      }

      .exercise-stats {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        background: #f5f5f5;
        padding: 15px;
        border-radius: 8px;
      }

      .stat-item {
        text-align: center;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #2c5aa0;
      }

      .stat-label {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
      }

      .workout-card {
        cursor: pointer;
        transition: transform 0.2s;
      }

      .workout-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }

      /* Form styling */
      .form-row {
        display: flex;
        gap: 15px;
      }

      .form-row .form-group {
        flex: 1;
      }

      @media (max-width: 768px) {
        .form-row {
          flex-direction: column;
          gap: 0;
        }
      }
    </style>

  <script>
    // Load workouts on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadDefaultWorkouts();
        loadPersonalWorkouts();
        setupModal();
    });

    // Setup modal functionality
    function setupModal() {
      const modal = document.getElementById('workoutModal');
      const closeBtn = document.querySelector('.close');
      
      closeBtn.onclick = function() {
        modal.style.display = 'none';
      }
      
      window.onclick = function(event) {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      }
    }

    // Show workout details in modal
    async function showWorkoutDetails(planId) {
      try {
        const response = await fetch(`/api/workouts/${planId}`);
        const workout = await response.json();
        
        if (response.ok) {
          const modal = document.getElementById('workoutModal');
          const modalContent = document.getElementById('modalContent');
          
          modalContent.innerHTML = `
            <div class="exercise-details">
              <h2>${workout.exercise_name}</h2>
              <img src="${workout.image_url || 'https://res.cloudinary.com/dgtx0alyb/image/upload/v1753629803/gzkf10jzp8hlmwefq9j9.png'}" 
                   alt="${workout.exercise_name}" 
                   class="exercise-image"
                   onerror="this.src='https://res.cloudinary.com/dgtx0alyb/image/upload/v1753629803/gzkf10jzp8hlmwefq9j9.png">
              
              <div class="exercise-stats">
                ${workout.reps ? `
                  <div class="stat-item">
                    <div class="stat-value">${workout.reps}</div>
                    <div class="stat-label">Reps</div>
                  </div>
                ` : ''}
                
                ${workout.sets ? `
                  <div class="stat-item">
                    <div class="stat-value">${workout.sets}</div>
                    <div class="stat-label">Sets</div>
                  </div>
                ` : ''}
                
                <div class="stat-item">
                  <div class="stat-value">${workout.duration_minutes}</div>
                  <div class="stat-label">Minutes</div>
                </div>

              </div>
              
              <div class="exercise-instructions">
                <h3>Instructions:</h3>
                <p>${workout.instructions || 'No specific instructions available.'}</p>
              </div>
              
              <div class="exercise-level">
                <p><strong>Level:</strong> ${workout.activity_level}</p>
              </div>
            </div>
          `;
          
          modal.style.display = 'block';
        }
      } catch (error) {
        console.error('Error loading workout details:', error);
        alert('Failed to load workout details.');
      }
    }

    // Load default workouts (updated to be clickable)
    async function loadDefaultWorkouts() {
      try {
        const response = await fetch('/api/workouts/default');
        const workouts = await response.json();
        
        const workoutList = document.getElementById('defaultWorkoutList');
        
        if (workouts.length === 0) {
          workoutList.innerHTML = '<p>No default workout plans available.</p>';
          return;
        }
        
        workoutList.innerHTML = workouts.map(workout => `
          <div class="feature-card default-workout workout-card" onclick="showWorkoutDetails(${workout.plan_id})">
            <h3>${workout.exercise_name}</h3>
            <p><strong>Duration:</strong> ${workout.duration_minutes} minutes</p>
            ${workout.reps ? `<p><strong>Reps:</strong> ${workout.reps}</p>` : ''}
            ${workout.sets ? `<p><strong>Sets:</strong> ${workout.sets}</p>` : ''}
            <p><strong>Level:</strong> ${workout.activity_level}</p>
            <span class="default-badge">Recommended</span>
            <p class="click-hint" style="font-size: 12px; color: #666; margin-top: 10px;">Click for details</p>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading default workouts:', error);
      }
    }

    // Load personal workouts (updated to be clickable)
    async function loadPersonalWorkouts() {
      try {
        const response = await fetch('/api/workouts/personal');
        const workouts = await response.json();
        
        const workoutList = document.getElementById('personalWorkoutList');
        
        if (workouts.length === 0) {
          workoutList.innerHTML = '<p>No personal workout plans found. Create your first workout plan!</p>';
          return;
        }
        
        workoutList.innerHTML = workouts.map(workout => `
          <div class="feature-card personal-workout workout-card" onclick="showWorkoutDetails(${workout.plan_id})">
            <h3>${workout.exercise_name}</h3>
            <p><strong>Duration:</strong> ${workout.duration_minutes} minutes</p>
            ${workout.reps ? `<p><strong>Reps:</strong> ${workout.reps}</p>` : ''}
            ${workout.sets ? `<p><strong>Sets:</strong> ${workout.sets}</p>` : ''}
            <p><strong>Level:</strong> ${workout.activity_level}</p>
            <div class="workout-actions" onclick="event.stopPropagation()">
              <button onclick="editWorkout(${workout.plan_id})" class="btn-small">Edit</button>
              <button onclick="deleteWorkout(${workout.plan_id})" class="btn-small btn-danger">Delete</button>
            </div>
            <p class="click-hint" style="font-size: 12px; color: #666; margin-top: 10px;">Click for details</p>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading personal workouts:', error);
      }
    }

    // Generate AI workout suggestion
    document.getElementById('generateWorkout').addEventListener('click', async function() {
      const button = this;
      const resultDiv = document.getElementById('aiWorkoutResult');
      
      button.disabled = true;
      button.innerHTML = '<span class="material-symbols-outlined">refresh</span> Generating...';
      
      try {
        const response = await fetch('/api/workouts/generate');
        const data = await response.json();
        
        if (response.ok) {
          resultDiv.innerHTML = `
            <div class="feature-card">
              <h3>AI Generated Workout Plan</h3>
              <p>${data.suggestion}</p>
            </div>
          `;
        } else {
          throw new Error(data.message || 'Failed to generate workout');
        }
      } catch (error) {
        console.error('Error generating workout:', error);
        resultDiv.innerHTML = `
          <div class="feature-card error">
            <h3>Error</h3>
            <p>Failed to generate workout suggestion. Please try again.</p>
          </div>
        `;
      } finally {
        button.disabled = false;
        button.innerHTML = '<span class="material-symbols-outlined">refresh</span> Generate New Workout Plan';
      }
    });

    // Handle form submission for personal workouts
    document.getElementById('workoutForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const workoutData = {
        exercise_name: formData.get('exerciseName'),
        duration_minutes: parseInt(formData.get('duration')),
        reps: formData.get('reps') ? parseInt(formData.get('reps')) : null,
        sets: formData.get('sets') ? parseInt(formData.get('sets')) : null,
        activity_level: formData.get('activityLevel'),
        image_url: formData.get('imageUrl') || null,
        instructions: formData.get('instructions') || null
      };
      
      try {
        const response = await fetch('/api/workouts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(workoutData)
        });
        
        if (response.ok) {
          alert('Personal workout plan added successfully!');
          this.reset();
          loadPersonalWorkouts(); // Reload only personal workouts
        } else {
          const error = await response.json();
          throw new Error(error.message || 'Failed to add workout');
        }
      } catch (error) {
        console.error('Error adding workout:', error);
        alert('Failed to add workout plan. Please try again.');
      }
    });

    // Delete personal workout
    async function deleteWorkout(planId) {
      if (confirm('Are you sure you want to delete this workout plan?')) {
        try {
          const response = await fetch(`/api/workouts/${planId}`, {
            method: 'DELETE'
          });
          
          if (response.ok) {
            alert('Workout plan deleted successfully!');
            loadPersonalWorkouts();
          } else {
            throw new Error('Failed to delete workout');
          }
        } catch (error) {
          console.error('Error deleting workout:', error);
          alert('Failed to delete workout plan.');
        }
      }
    }
  </script>
</body>
</html>