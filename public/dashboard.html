<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
  <header>
    <div class="container header-container">
      <img src="./assets/CareConnectblue.png" alt="CareConnect Logo" class="logo">
      <nav>
        <ul class="nav-list">
          <li><a href="./index.html">Home</a></li>
          <li><a href="./profile.html">Profile</a></li>
          <li><a href="./health-records.html">Health Records</a></li>
          <li><a href="./logout.html">Logout</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section id="user-info">
      <h2>Hello, <span id="username"></span></h2>
    </section>

    <section id="bmi-meter">
      <h3>Your BMI</h3>
      <p id="bmiValue">Loading...</p>
      <div id="bmiProgress" style="height: 20px; background-color: #4CAF50; width: 0;"></div>
    </section>

    <section id="friends-list">
      <h3>Friends List</h3>
      <ul id="friendsList">
        <!-- Friend list items will be injected here -->
      </ul>
    </section>

    <section id="upcoming-events">
      <h3>Upcoming Events</h3>
      <ul id="eventsList">
        <!-- Upcoming events will be injected here -->
      </ul>
    </section>
  </main>

  <script>
    const token = localStorage.getItem("token");

    // Fetch and display user info (e.g., username)
    async function fetchUserInfo() {
      const res = await fetch('/dashboard/user-info', {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const data = await res.json();
      document.getElementById("username").innerText = data.name;
    }

    // Fetch and display BMI
    async function fetchBMI() {
      const res = await fetch('/dashboard/bmi', {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const data = await res.json();
      document.getElementById("bmiValue").innerText = `Your BMI is: ${data.bmi}`;
      document.getElementById("bmiProgress").style.width = `${Math.min(100, (data.bmi - 15) * 6)}%`;
    }

    // Fetch and display friends list
    async function fetchFriendsList() {
      const res = await fetch('/dashboard/friends', {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const friends = await res.json();
      const friendsList = document.getElementById("friendsList");
      friendsList.innerHTML = friends.map(friend => `<li>${friend.name}</li>`).join('');
    }

    // Fetch and display upcoming events
    async function fetchUpcomingEvents() {
      const res = await fetch('/dashboard/events', {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const events = await res.json();
      const eventsList = document.getElementById("eventsList");
      eventsList.innerHTML = events.map(event => `
        <li>${event.title} - ${new Date(event.event_time).toLocaleDateString()}</li>
      `).join('');
    }

    // Call all the functions on page load
    fetchUserInfo();
    fetchBMI();
    fetchFriendsList();
    fetchUpcomingEvents();
  </script>
</body>
</html>
